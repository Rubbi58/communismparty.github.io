<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TEST â€“ Simple Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }
    #hud {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: #100408;
      color: #ffcc66;
      font-size: 12px;
      line-height: 30px;
      padding: 0 10px;
    }
    canvas {
      position: fixed;
      top: 30px;
      left: 0;
      width: 100vw;
      height: calc(100vh - 30px);
      display: block;
      background: #000;
    }
  </style>
</head>
<body>
  <div id="hud">TEST: Move the white square with WASD. If you can see it, JS works.</div>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 30;
    }
    window.addEventListener("resize", resize);
    resize();

    const TILE = 40;
    const MAP_W = 15;
    const MAP_H = 10;

    // 0 = wall, 1 = floor
    const map = [
      "000000000000000",
      "011111111111110",
      "011000001000010",
      "011000001000010",
      "011111111111110",
      "011000000000010",
      "011000011100010",
      "011000010000010",
      "011111111111110",
      "000000000000000"
    ];

    function isFloor(x,y){
      if (x<0||y<0||x>=MAP_W||y>=MAP_H) return false;
      return map[y][x] === "1";
    }

    const player = { x: 3.5, y: 5.5, speed: 4 };
    const keys = {w:false,a:false,s:false,d:false};

    window.addEventListener("keydown", e=>{
      if (e.key==="w"||e.key==="W") keys.w=true;
      if (e.key==="a"||e.key==="A") keys.a=true;
      if (e.key==="s"||e.key==="S") keys.s=true;
      if (e.key==="d"||e.key==="D") keys.d=true;
    });
    window.addEventListener("keyup", e=>{
      if (e.key==="w"||e.key==="W") keys.w=false;
      if (e.key==="a"||e.key==="A") keys.a=false;
      if (e.key==="s"||e.key==="S") keys.s=false;
      if (e.key==="d"||e.key==="D") keys.d=false;
    });

    let last = performance.now();

    function loop(time){
      const dt = (time-last)/1000;
      last = time;

      // movement
      let dx=0, dy=0;
      if (keys.w) dy-=1;
      if (keys.s) dy+=1;
      if (keys.a) dx-=1;
      if (keys.d) dx+=1;
      const len = Math.hypot(dx,dy);
      if (len>0){dx/=len;dy/=len;}

      const step = player.speed*dt;
      const nx = player.x + dx*step;
      const ny = player.y + dy*step;

      if (isFloor(Math.floor(nx), Math.floor(player.y))) player.x = nx;
      if (isFloor(Math.floor(player.x), Math.floor(ny))) player.y = ny;

      // draw
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const camX = player.x*TILE - canvas.width/2;
      const camY = player.y*TILE - canvas.height/2;

      for (let y=0;y<MAP_H;y++){
        for (let x=0;x<MAP_W;x++){
          const sx = x*TILE - camX;
          const sy = y*TILE - camY;
          if (map[y][x]==="0") {
            ctx.fillStyle="#22080c";
          } else {
            ctx.fillStyle="#4a1517";
          }
          ctx.fillRect(sx,sy,TILE,TILE);
        }
      }

      // player
      ctx.fillStyle="#ffffff";
      ctx.fillRect(player.x*TILE - camX - 10, player.y*TILE - camY - 10, 20, 20);

      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);
  </script>
</body>
</html>
